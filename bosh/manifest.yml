name: nfs-volume

releases:
- name: consul
  version: latest
- name: nfs-volume
  version: latest

stemcells:
- alias: default
  name: bosh-aws-xen-hvm-ubuntu-trusty-go_agent
  version: latest

update:
  canaries: 1
  max_in_flight: 4
  canary_watch_time: 1000-600000
  update_watch_time: 1000-600000

instance_groups:
- name: nfs-server
  persistent_disk_type: nfs-volume
  vm_type: nfs-volume
  stemcell: default
  azs: [z1]
  networks:
  - name: services
  instances: 1
  jobs:
  - name: consul_agent
    release: consul
    consumes:
      consul_common:
        from: consul_common_link
        deployment: ((cf_deployment))
      consul_server: nil
      consul_client:
        from: consul_client_link
        deployment: ((cf_deployment))
    properties:
      consul:
        agent:
          services:
            nfstestserver:
              name: nfstestserver
              check: {}
  - name: nfstestserver
    release: nfs-volume
    properties:
      nfstestserver:
        export_volumes: ((nfstestserver-volumes))
